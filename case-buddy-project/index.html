<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://mozilla.github.io/pdf.js/build/pdf.mjs" type="module"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* A slightly off-white for better contrast */
        }
        main {
             background-color: #ffffff;
        }
        /* Gradient for text and backgrounds */
        .gradient-text {
            background-image: linear-gradient(to right, #3b82f6, #10b981); /* blue-500 to emerald-500 */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .gradient-bg {
             background-image: linear-gradient(to right, #3b82f6, #10b981);
        }
        /* Styles for filter buttons */
        .filter-btn {
            transition: all 0.2s ease-in-out;
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .filter-btn.active {
            background-image: linear-gradient(to right, #3b82f6, #10b981);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 4px 14px 0 rgba(0, 118, 255, 0.39);
        }
        /* Styles for case cards */
        .case-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            border-color: #3b82f6; 
        }
        /* Modal backdrop styles */
        #company-modal, #warning-modal, #feedback-modal {
            backdrop-filter: blur(4px);
        }
        /* PDF Viewer Styles */
        #pdf-render-container { position: relative; overflow-y: auto; }
        #pdf-canvas { 
            display: block; 
            margin: 0 auto;
            transition: opacity 0.3s ease-in-out;
        }
        #pdf-controls {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 10;
        }
        
        /* Updated Star Rating Styles */
        .star-rating {
            direction: rtl; /* Reverses item order for CSS sibling selector trick */
            display: inline-flex;
        }
        .star-rating input[type="radio"] { 
            display: none; 
        }
        .star-rating label {
            cursor: pointer;
            color: #d1d5db; /* gray-300 */
            font-size: 2.5rem;
            transition: color 0.2s ease-in-out;
        }
        /* This single rule handles hover and checked states correctly */
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input[type="radio"]:checked ~ label {
            color: #f59e0b; /* amber-500 */
        }
        
        /* Overall Rating Display Styles */
        #overall-rating-display .star {
            color: #d1d5db; /* gray-300 */
            font-size: 2.5rem;
        }
        #overall-rating-display .star.filled {
            color: #f59e0b; /* amber-500 */
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Dashboard specific styles */
        .dashboard-animate-fade-in { animation: fadeIn 0.5s; } 
        @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-8">
                    <div class="flex items-center cursor-pointer" id="home-button">
                        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="url(#grad1)">
                            <defs>
                               <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                                 <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                 <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                               </linearGradient>
                            </defs>
                            <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                        </svg>
                        <span class="ml-3 text-2xl font-bold gradient-text">Case Buddy</span>
                    </div>
                     <div class="flex items-center gap-6">
                        <button id="nav-dashboard-btn" class="text-slate-600 hover:text-blue-600 font-semibold transition-colors">Dashboard</button>
                        <button id="nav-about-btn" class="text-slate-600 hover:text-blue-600 font-semibold transition-colors">About</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8 mt-4 rounded-lg shadow-md bg-white">

        <!-- WELCOME / FILTER VIEW -->
        <div id="welcome-view">
            <div class="text-center my-12">
                <h1 class="text-5xl md:text-6xl font-extrabold gradient-text">Ready to crack a case?</h1>
                <p class="text-slate-500 text-lg mt-4">Let's find the perfect one for you.</p>
            </div>

            <div class="max-w-4xl mx-auto p-8 space-y-10">
                <!-- Case Type Filter -->
                <div class="grid md:grid-cols-3 items-start gap-4">
                    <h2 class="text-lg font-semibold text-slate-700 mt-2">What's the case style?</h2>
                    <div id="type-filters" class="md:col-span-2 flex flex-wrap gap-3">
                        <!-- Type buttons will be injected here -->
                    </div>
                </div>

                <!-- Difficulty Filter -->
                <div class="grid md:grid-cols-3 items-start gap-4">
                    <h2 class="text-lg font-semibold text-slate-700 mt-2">Choose your challenge.</h2>
                    <div id="difficulty-filters" class="md:col-span-2 flex flex-wrap gap-3">
                        <!-- Difficulty buttons will be injected here -->
                    </div>
                </div>

                <!-- Company Filter -->
                <div class="grid md:grid-cols-3 items-start gap-4">
                    <h2 class="text-lg font-semibold text-slate-700 mt-2">Any firm in mind?</h2>
                    <div class="md:col-span-2">
                        <button id="open-company-modal-btn" class="w-full text-left p-3 border rounded-lg hover:border-blue-500 transition">
                            Select Companies
                        </button>
                        <p id="company-count" class="text-sm text-slate-500 mt-2 h-4"></p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center pt-8">
                    <button id="search-cases-btn" class="gradient-bg text-white px-10 py-3 rounded-lg font-semibold hover:opacity-90 transition transform hover:scale-105 shadow-lg">
                        Find Your Case
                    </button>
                    <p class="mt-6 text-slate-500">Or, if you're feeling adventurous...</p>
                    <button id="view-all-btn" class="mt-2 font-semibold text-transparent gradient-text hover:opacity-80">
                        View the Entire Case Library
                    </button>
                </div>
            </div>
        </div>
        
        <!-- CASE LIBRARY VIEW -->
        <div id="case-library-view" class="hidden">
            <div class="flex justify-between items-center mb-8">
                 <h1 class="text-4xl font-bold gradient-text">Case Library</h1>
                 <button id="back-to-filters-btn" class="font-semibold text-slate-600 hover:text-slate-900 transition">
                     &larr; Back to Filters
                 </button>
            </div>
            <div id="case-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Case cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- DETAILED CASE VIEW -->
        <div id="detailed-case-view" class="hidden">
             <div class="flex items-center space-x-4 mb-6">
                <span id="case-detail-type" class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full"></span>
                <span id="case-detail-company" class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"></span>
                <span id="case-detail-difficulty" class="bg-yellow-100 text-yellow-800 text-sm font-medium px-3 py-1 rounded-full"></span>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-4 gradient-text">Problem Statement</h2>
                    <p id="case-detail-problem" class="text-slate-600 leading-relaxed"></p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md flex flex-col">
                    <h2 class="text-2xl font-bold mb-4 gradient-text">Instructions for Solver</h2>
                    <div class="text-slate-600 space-y-3 flex-grow">
                        <p>1. Read the problem statement carefully.</p>
                        <p>2. Take a moment to structure your thoughts.</p>
                        <p>3. When ready, click "Do this case" to begin the interactive session with your buddy (interviewer).</p>
                        <p>4. You will then guide the case, asking clarifying questions and presenting your framework.</p>
                    </div>
                    <div class="mt-6 text-right">
                         <button id="back-to-library-btn" class="bg-slate-200 text-slate-700 px-6 py-3 rounded-lg font-semibold hover:bg-slate-300 transition mr-2">Back to Library</button>
                        <button id="do-case-btn" class="gradient-bg text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition">Do this case</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- IN-PROGRESS VIEW -->
        <div id="in-progress-view" class="hidden">
             <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md h-[85vh] flex flex-col lg:col-span-2">
                    <h2 id="casebook-title" class="text-2xl font-bold mb-4 shrink-0 gradient-text">Interviewer's Guide</h2>
                    <div id="pdf-render-container" class="flex-grow rounded-lg overflow-hidden border bg-slate-100 p-2">
                        <canvas id="pdf-canvas"></canvas>
                        <div id="pdf-controls">
                            <button id="pdf-prev" class="text-white hover:text-blue-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                            </button>
                            <span class="text-white font-mono text-sm">
                                <span id="page-num"></span> / <span id="page-count"></span>
                            </span>
                            <button id="pdf-next" class="text-white hover:text-blue-300 disabled:opacity-50 disabled:cursor-not-allowed">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                            </button>
                            <button id="pdf-fullscreen" class="text-white hover:text-blue-300 ml-4">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5" /></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md flex flex-col">
                    <h2 class="text-2xl font-bold mb-4 gradient-text">Instructions for Interviewer</h2>
                    <div class="text-slate-600 space-y-3 flex-grow">
                        <p>1. Use the casebook PDF on the left to guide the interviewee.</p>
                        <p>2. Provide hints only when necessary to keep the case moving.</p>
                        <p>3. Take notes on the interviewee's structure, creativity, and quantitative skills.</p>
                        <p>4. Once the case is concluded, click "End this case" to provide feedback.</p>
                    </div>
                    <div class="mt-6 text-right">
                        <button id="end-case-btn" class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition">End this case</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABOUT VIEW -->
        <div id="about-view" class="hidden">
            <div class="max-w-4xl mx-auto py-12">
                <h1 class="text-5xl font-extrabold gradient-text text-center">About Case Buddy</h1>
                <p class="text-slate-600 text-lg mt-6 text-center">Your personal partner for mastering the case interview.</p>
                <div class="mt-10 text-slate-700 leading-relaxed space-y-4">
                    <p><strong>Case Buddy</strong> was designed to streamline the case interview preparation process for aspiring consultants. We believe that practice is key, but effective practice requires the right tools. Our platform provides a comprehensive library of real-world case studies from top consulting firms, allowing you to hone your skills in a structured and realistic environment.</p>
                    <p>Whether you're practicing solo or with a partner, Case Buddy provides the resources you need. The "Interviewer" and "Interviewee" views simulate a real interview, with a complete interviewer's guide available to help provide constructive feedback.</p>
                    <p>Our goal is to make high-quality case prep accessible to everyone. Use our filtering tools to find cases that match your target firms and desired difficulty, track your progress on the dashboard, and walk into your interviews with confidence.</p>
                </div>
                <div class="mt-12">
                    <h2 class="text-3xl font-bold text-slate-800 text-center">Meet the Founders</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mt-8 text-center">
                        <div class="p-4">
                            <p class="font-semibold text-lg text-slate-700">Nitya Mall</p>
                        </div>
                        <div class="p-4">
                            <p class="font-semibold text-lg text-slate-700">Niepun Singhal</p>
                        </div>
                        <div class="p-4">
                            <p class="font-semibold text-lg text-slate-700">Pratik Agarwal</p>
                        </div>
                        <div class="p-4">
                            <p class="font-semibold text-lg text-slate-700">Saksham Didwania</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DASHBOARD VIEW -->
        <div id="dashboard-view" class="hidden">
            <div class="max-w-7xl mx-auto">
                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-r-lg" role="alert">
                    <p class="font-bold">Disclaimer</p>
                    <p>This dashboard is for representational purposes only. The data is pre-filled and does not reflect your actual case performance yet.</p>
                </div>

                <header class="mb-4">
                    <h1 class="text-3xl font-bold text-slate-800">My Case Prep Dashboard</h1>
                    <p class="text-slate-500 mt-1">Your comprehensive performance and progress tracker.</p>
                </header>
                
                <div class="flex justify-between items-center mb-4">
                    <div id="dashboard-date-picker" class="flex gap-2 items-center">
                        <!-- Date picker will be rendered here by JS -->
                    </div>
                    <div class="flex gap-4 items-center text-xs text-gray-600">
                        <span class="font-semibold">Score Legend:</span>
                        <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-red-500 mr-1.5"></div>Poor (&lt;70)</div>
                        <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-amber-500 mr-1.5"></div>Medium (70-84)</div>
                        <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-green-500 mr-1.5"></div>Good (85+)</div>
                    </div>
                </div>
                <div id="dashboard-active-filters">
                    <!-- Active filters will be rendered here by JS -->
                </div>

                <main class="space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 space-y-6">
                            <div class="bg-white p-6 rounded-lg shadow text-center">
                                <h2 class="text-lg font-semibold text-gray-600">Weighted Score</h2>
                                <div id="dashboard-score-card" class="font-bold my-2">
                                    <!-- Score will be rendered here by JS -->
                                </div>
                                <p class="text-gray-500 text-sm">Avg. score for selected filters.</p>
                            </div>
                            <div id="dashboard-metric-breakdown">
                                <!-- Detailed metrics will be rendered here by JS -->
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-6">
                            <div id="dashboard-type-chart">
                                <!-- Performance by type chart will be rendered here by JS -->
                            </div>
                            <div id="dashboard-difficulty-chart">
                                <!-- Performance by difficulty chart will be rendered here by JS -->
                            </div>
                        </div>
                    </div>

                    <div id="dashboard-key-takeaways">
                        <!-- Key takeaways will be rendered here by JS -->
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 pt-6 border-t">
                        <div id="dashboard-case-summary">
                            <!-- Case summary table will be rendered here by JS -->
                        </div>
                        <div id="dashboard-calendar-tracker">
                            <!-- Calendar will be rendered here by JS -->
                        </div>
                    </div>
                </main>
            </div>
        </div>

    </main>

    <!-- COMPANY SELECTION MODAL -->
    <div id="company-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform transition-all flex flex-col h-[80vh]">
            <div class="p-6 border-b">
                <h2 class="text-2xl font-bold gradient-text">Select Companies</h2>
            </div>
            <div id="company-list" class="p-6 overflow-y-auto flex-grow grid grid-cols-2 md:grid-cols-3 gap-4">
                <!-- Company checkboxes will be injected here -->
            </div>
            <div class="p-4 bg-slate-50 border-t flex justify-between items-center">
                 <label class="flex items-center space-x-2 font-semibold">
                     <input type="checkbox" id="all-companies-checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                     <span>Select All</span>
                 </label>
                <div>
                    <button id="clear-companies-btn" class="px-6 py-2 rounded-lg font-semibold hover:bg-slate-200 transition mr-2">Clear</button>
                    <button id="apply-companies-btn" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Apply</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- WARNING MODAL -->
    <div id="warning-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md transform transition-all text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 mb-4">
                <svg class="h-6 w-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
            </div>
            <h2 class="text-2xl font-bold mb-2">Heads Up!</h2>
            <p class="text-slate-600 mb-6">You are about to enter the interviewer's view, which contains the full case solution. Proceed only if you are the designated interviewer.</p>
            <div class="flex justify-center space-x-4">
                <button id="cancel-warning-btn" class="bg-slate-200 text-slate-700 px-6 py-2 rounded-lg font-semibold hover:bg-slate-300 transition">Cancel</button>
                <button id="proceed-btn" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Proceed to Interview</button>
            </div>
        </div>
    </div>

    <!-- FEEDBACK MODAL -->
    <div id="feedback-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg transform transition-all" id="feedback-modal-content">
            <h2 class="text-2xl font-bold mb-6 gradient-text">Case Feedback</h2>

            <div id="rating-parameters" class="space-y-4">
                 <!-- Structure -->
                 <div class="flex justify-between items-center">
                    <label class="text-slate-700 font-semibold">Structure</label>
                    <div class="star-rating" data-parameter="structure" data-weight="0.35">
                        <input type="radio" id="structure-star5" name="structure-rating" value="5" /><label for="structure-star5">&#9733;</label>
                        <input type="radio" id="structure-star4" name="structure-rating" value="4" /><label for="structure-star4">&#9733;</label>
                        <input type="radio" id="structure-star3" name="structure-rating" value="3" /><label for="structure-star3">&#9733;</label>
                        <input type="radio" id="structure-star2" name="structure-rating" value="2" /><label for="structure-star2">&#9733;</label>
                        <input type="radio" id="structure-star1" name="structure-rating" value="1" /><label for="structure-star1">&#9733;</label>
                    </div>
                </div>
                <!-- Case Understanding -->
                <div class="flex justify-between items-center">
                    <label class="text-slate-700 font-semibold">Case Understanding</label>
                    <div class="star-rating" data-parameter="understanding" data-weight="0.25">
                        <input type="radio" id="understanding-star5" name="understanding-rating" value="5" /><label for="understanding-star5">&#9733;</label>
                        <input type="radio" id="understanding-star4" name="understanding-rating" value="4" /><label for="understanding-star4">&#9733;</label>
                        <input type="radio" id="understanding-star3" name="understanding-rating" value="3" /><label for="understanding-star3">&#9733;</label>
                        <input type="radio" id="understanding-star2" name="understanding-rating" value="2" /><label for="understanding-star2">&#9733;</label>
                        <input type="radio" id="understanding-star1" name="understanding-rating" value="1" /><label for="understanding-star1">&#9733;</label>
                    </div>
                </div>
                 <!-- Delivery -->
                 <div class="flex justify-between items-center">
                    <label class="text-slate-700 font-semibold">Delivery</label>
                    <div class="star-rating" data-parameter="delivery" data-weight="0.25">
                        <input type="radio" id="delivery-star5" name="delivery-rating" value="5" /><label for="delivery-star5">&#9733;</label>
                        <input type="radio" id="delivery-star4" name="delivery-rating" value="4" /><label for="delivery-star4">&#9733;</label>
                        <input type="radio" id="delivery-star3" name="delivery-rating" value="3" /><label for="delivery-star3">&#9733;</label>
                        <input type="radio" id="delivery-star2" name="delivery-rating" value="2" /><label for="delivery-star2">&#9733;</label>
                        <input type="radio" id="delivery-star1" name="delivery-rating" value="1" /><label for="delivery-star1">&#9733;</label>
                    </div>
                </div>
                 <!-- Creativity -->
                 <div class="flex justify-between items-center">
                    <label class="text-slate-700 font-semibold">Creativity</label>
                    <div class="star-rating" data-parameter="creativity" data-weight="0.15">
                        <input type="radio" id="creativity-star5" name="creativity-rating" value="5" /><label for="creativity-star5">&#9733;</label>
                        <input type="radio" id="creativity-star4" name="creativity-rating" value="4" /><label for="creativity-star4">&#9733;</label>
                        <input type="radio" id="creativity-star3" name="creativity-rating" value="3" /><label for="creativity-star3">&#9733;</label>
                        <input type="radio" id="creativity-star2" name="creativity-rating" value="2" /><label for="creativity-star2">&#9733;</label>
                        <input type="radio" id="creativity-star1" name="creativity-rating" value="1" /><label for="creativity-star1">&#9733;</label>
                    </div>
                </div>
            </div>

            <hr class="my-6">

            <div class="text-center">
                <div class="flex justify-center items-center gap-2">
                    <p class="text-slate-700 font-semibold">Overall Rating</p>
                    <div class="group relative">
                        <!-- Info icon that triggers tooltip on hover -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 cursor-pointer" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        <!-- The tooltip content -->
                        <div class="absolute bottom-full z-10 mb-2 w-64 bg-slate-800 text-white text-xs rounded-lg py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                            Weighted average: Structure (35%), Case Understanding (25%), Delivery (25%), Creativity (15%).
                            <svg class="absolute text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"><polygon class="fill-current" points="0,0 127.5,127.5 255,0"/></svg>
                        </div>
                    </div>
                </div>
                <div id="overall-rating-display" class="flex justify-center mt-1">
                    <!-- Stars will be injected here by JS -->
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 mt-8">
                <button id="save-feedback-btn" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Save</button>
            </div>
        </div>
    </div>

    <!-- CALENDAR DAY DETAIL MODAL -->
    <div id="calendar-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 dashboard-animate-fade-in">
        <div id="calendar-modal-content" class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-md">
            <!-- Content will be injected by JS -->
        </div>
    </div>


    <script type="module">
        // --- PDF.js Setup ---
        const { pdfjsLib } = globalThis;
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://mozilla.github.io/pdf.js/build/pdf.worker.mjs`;

        // --- Data ---
        const allCases = [
            { id: 1, title: 'Accelerating Prosperity', type: 'Growth', difficulty: 'Easy', company: 'Kepler Cannon', problem: 'How would you, as a consultant, for PM Modi, advise him to grow the GDP of India faster than any other country and generate lots of jobs in the process? The aim is prosperity and has to be done by our recommendation only.'},
            { id: 2, title: 'An Apple a Day', type: 'Unconventional', difficulty: 'Easy', company: 'Accenture Strategy', problem: "You're a part of Apple's strategy team. Apple is considering to start renting out earphones on an early basis, should they go ahead with it or not?"},
            { id: 3, title: 'Brewing Success', type: 'Market Entry', difficulty: 'Moderate', company: 'Accenture Strategy', problem: 'You have to open a coffee shop in Delhi. What are the factors you would consider?'},
            { id: 4, title: 'Bucks over Brands', type: 'Market Entry', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'Your Company has 2 online retail shops, one is a premium retail shop and the other one is a cheap retail shop. Both are very similar in nature, so figure out the possible reasons as to why the cheaper retail store has a higher profit margin than the premium shop.'},
            { id: 5, title: 'Building the Bank', type: 'Profitability', difficulty: 'High', company: 'McKinsey & Co.', problem: 'The client in a Banking Client from a large private sector firm - like Axis Bank- in India. The company wants to start a 3-in-1 account: a savings account + DMAT account + Trading account. The company already has a customer base of 5 million people. How would you determine how many people are interested to sign up for this?'},
            { id: 6, title: 'Can Taylor Swift come to India?', type: 'Profitability', difficulty: 'High', company: 'McKinsey & Co.', problem: 'You are Taylor Swift’s Brand Manager. Do you think Taylor swift should enter the Indian Market? Give a complete financial analysis with relevant justifications.'},
            { id: 7, title: 'Can the ants cross each other?', type: 'Unconventional', difficulty: 'Moderate', company: 'Bain Capability Network', problem: "There is an equilateral triangle and there is an ant present at each end. What is the probability that these ants don't cross each other?"},
            { id: 8, title: 'Candy Catastrophe', type: 'Profitability', difficulty: 'Moderate', company: 'Accenture Strategy', problem: 'Your client is an FMCG manufacturer comparable to Cadbury. The company has been facing a decline in profits. Help them figure out the exact reason for this decline.'},
            { id: 9, title: 'Cash Capsule', type: 'Profitability', difficulty: 'Moderate', company: 'McKinsey & Co.', problem: 'Your client is a pharmaceutical company in the USA. They have finished phase 3 trials of a pill. Its price is $2, and it treats a neurological disorder. You are required to calculate the revenue for the first year.'},
            { id: 10, title: 'Chic Expansion', type: 'Market Entry', difficulty: 'Moderate', company: 'BOD Consulting', problem: 'You are based in London, UK, and own a chain of fashion retailers. You feel that you have saturated your market in the UK. The company wants you to identify the factors to be considered in this entire decision-making process.'},
            { id: 11, title: 'Childhood Shield', type: 'Unconventional', difficulty: 'High', company: 'McKinsey & Co.', problem: 'A disease is spreading in South Africa that primarily affects children, and it can be contained through vaccination. However, a substantial portion of the population has not received vaccination. How would you approach this problem?'},
            { id: 12, title: 'Coffee Madness', type: 'Market Entry', difficulty: 'Easy', company: 'Accenture Strategy', problem: 'A coffee shop wants to enter the Delhi University Market. Should it? Why or why not?'},
            { id: 13, title: 'Cracking the Tile', type: 'Profitability', difficulty: 'Moderate', company: 'Boston Consulting Group', problem: "Your client is a tile manufacturing company, operating in the whole of India. They're facing a fall in their profits, in West and South Delhi. They're not facing this decline in the northern part. A 2-3% fall in the market share and a 15-18% fall in profits. Within India, we're ranked 5th as the tile manufacturing company. Awareness is the same in north and south, while consideration is one third. What according to you are the potential reasons?"},
            { id: 14, title: 'Data Insight', type: 'Unconventional', difficulty: 'High', company: 'McKinsey & Co.', problem: 'Devise ways to leverage the data Like customer names, the number of watches purchased, and their addresses for understanding consumer behaviour, and preferences, and potentially improving business strategies for the watch shop.'},
            { id: 15, title: "Don't Sugarcoat it!", type: 'Profitability', difficulty: 'Easy', company: 'Nation with Namo', problem: 'Your client is a sugarcane factory in India. The company is facing stagnant profits. You need to find the reasons for the problem.'},
            { id: 16, title: 'Droned Crops!', type: 'Market Entry', difficulty: 'Moderate', company: 'McKinsey & Co.', problem: 'Estimate the Market size of agricultural spray drones?'},
            { id: 17, title: 'Dynamic Democracy', type: 'Unconventional', difficulty: 'Easy', company: 'Nation With Namo', problem: 'Your client is a local successful businessman who is active socially with NGOs. He wants to stand as an independent candidate in the Shakarupur constituency. Advise the client on this political endeavor.'},
            { id: 18, title: 'Efficient Transit', type: 'Unconventional', difficulty: 'High', company: 'Kearney', problem: 'Our Client is the Ministry of Transport and they want to improve the logistical efficiency.'},
            { id: 19, title: 'Expansion Endeavours', type: 'Growth', difficulty: 'Moderate', company: 'Boston Consulting Group', problem: 'Your Client is a Non banking financial company and functions as a public sector undertaking. Suggest a suitable growth strategy.'},
            { id: 20, title: 'Fitness Finances', type: 'Market Entry', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'Your client is a health tech startup that manufactures special wearable devices like smartwatches or shoulder pads which measure the fitness of an individual. The company caters to the age group of 25-45 years. The price of one watch is $150. Calculate the annual revenue in the target market having 40 health-tech startups and the profit per unit.'},
            { id: 21, title: 'Get your Pulse on It', type: 'Market Entry', difficulty: 'Moderate', company: 'Bain Capability Network', problem: 'The manufacturer of a health-tech device is planning to launch the product in the US market. This is their very first product launch. Estimate their market size.'},
            { id: 22, title: 'Good and Excellent', type: 'Profitability', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'There are two drink companies. One is named Good. Another is Excellent. They both have a steady revenue growth for the past five years and the market size of both these are the same. The Good profits have been steady but Excellent profits are fluctuating. Find reason for the fluctuating profits of Excellent company.'},
            { id: 23, title: 'Growth Beyond Borders', type: 'Market Entry', difficulty: 'High', company: 'LEK Capability Network', problem: 'Your client is a fast fashion retail chain called My Brands. They have a considerable market share in the US economy but are now facing market saturation. They want to expand to new geographies but aren’t sure where to expand. Your task is to first list down the different factors to evaluate a potential geography to which they can extend their operations and state what strategies you would use to enter that particular country or geography.'},
            { id: 24, title: 'Home Haven Expansion', type: 'Growth', difficulty: 'Moderate', company: 'Redseer Consulting', problem: 'Our Client Amazon India is growing in the home furnishing industry and they want to grow faster.'},
            { id: 25, title: 'Hotel Shotel', type: 'Market Entry', difficulty: 'High', company: 'Kearney', problem: 'Your client is a large hotel chain that wishes to enter the Indian market. How would you advise them to go about it?'},
            { id: 26, title: 'Ink In or Ink Out?', type: 'Market Entry', difficulty: 'High', company: 'Accenture Strategy', problem: 'Your client is a paper manufacturing company based out of Indonesia. They operate in the B2B space and sell paper to publishing houses. They are considering expanding operations by entering India. Ascertain if this is a good strategy.'},
            { id: 27, title: 'Learning the English Way', type: 'Unconventional', difficulty: 'High', company: 'Alvarez and Marsal', problem: 'Your client is Vedantu and Indian edtech giant seeking to enter three European countries. Give four parameters that you would consider with your rationale behind it.'},
            { id: 28, title: 'LifeEpic Launch', type: 'Market Entry', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'Your client is a major magazine publisher based in the US. It is considering the idea of launching a new lifestyle magazine. Analyse and recommend if he should go ahead with this idea.'},
            { id: 29, title: 'Lights, Camera, Fashion!', type: 'Market Entry', difficulty: 'High', company: 'LEK Capability Network', problem: 'Your client is a fashion retail brand called Watson. They are based in the US and are looking to expand because the US market has matured. Identify which market they should enter and create a framework to devise a checklist for evaluating countries to streamline entry decisions.'},
            { id: 30, title: 'Logistics Boost', type: 'Unconventional', difficulty: 'High', company: 'Kearney', problem: 'Our Client is the Ministry of Transport and they want to improve the logistical efficiency. You can talk about an approach to calculate the demand for roads at any point in time.'},
            { id: 31, title: 'Lubricant Lament', type: 'Growth', difficulty: 'Moderate', company: 'Boston Consulting Group', problem: 'Your Client is a lubricant player for 10 years in the Indian Market. They are ranked 3rd globally, and 8th in India. However, they are struggling with their Indian Market Presence. They want an aggressive market growth strategy where they want to increase their market growth by 5 times in the coming 1-2 years.'},
            { id: 32, title: 'Lux Cabs but Lax Revenues', type: 'Profitability', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'There are two cab aggregators- Quickride and Lux Cabs. The revenue of the former is stable. However, that of the latter is fluctuating. You are the CEO and the other board members are quite agitated because of this. What solutions would you propose?'},
            { id: 33, title: 'Mad Amount of Angles', type: 'Profitability', difficulty: 'Easy', company: 'Boston Consulting Group', problem: "Your client is a potato snacks company in the Middle East. They're facing a gradual decline in their profits over the last five to six years. It was a gradual decline. Find out why."},
            { id: 34, title: 'Meat Me at our Spot', type: 'Unconventional', difficulty: 'Easy', company: 'Boston Consulting Group', problem: 'Your client is mock-meat manufacturer. Come at a particular income class of people who actually buy this product?'},
            { id: 35, title: 'Metals to Multiverse', type: 'Market Entry', difficulty: 'High', company: 'Kepler Cannon', problem: 'Your client is running a Mining and Metals Company. Now, they want to enter different industries. How would you go about evaluating its options?'},
            { id: 36, title: 'Not a Coin Toss', type: 'Unconventional', difficulty: 'Moderate', company: 'Nation with Namo', problem: 'There is an election and two candidates are being considered for it. Compare two candidates for the same.'},
            { id: 37, title: 'Party at the Polls', type: 'Unconventional', difficulty: 'Moderate', company: 'Nation With Namo', problem: 'Develop a strategy to engage young, first-time voters in your area and encourage them to vote for your party.'},
            { id: 38, title: 'Pigment Prospects', type: 'Market Entry', difficulty: 'Moderate', company: 'McKinsey & Co.', problem: 'The client specializes in producing pigments used in household paints and cosmetics. As a family-run business, they are looking to invest and are deciding between the house paint and makeup segments. Their main objective is to improve their business and secure its future. Evaluate segments where they can diversify.'},
            { id: 39, title: 'Pipes to Progress', type: 'Growth', difficulty: 'High', company: 'Kearney', problem: "Our client is an iron pipe manufacturing company. Their revenues have been stagnant, and they're seeking ways to increase growth. What approach would you suggest?"},
            { id: 40, title: 'Potato Potahto', type: 'Profitability', difficulty: 'Easy', company: 'Bain Capability Network', problem: "Your client is a potato snacks company in the Middle East. They're facing a gradual decline in their profits over the last five to six years. And you need to find out why. Additionally, it was a gradual decline."},
            { id: 41, title: 'Profit Puzzle', type: 'Profitability', difficulty: 'High', company: 'LEK Capability Network', problem: 'In the US market, there are two online retailers, Budget Mart and Elite Goods. Budget Mart provides budget-friendly goods to consumers, and Elite Goods caters to only the high-income groups, providing premium products at high prices. The revenue of Budget Mart is $100 million, and for Elite Goods, it is $120 million dollars. However, the profit margin of Budget Mart is greater than the profit of Elite Goods. Your client is Elite Goods, and it wants you to identify why Budget Mart has greater profits even after catering to the lower-income category. As a consultant, you are required to pinpoint those key areas due to which Elite Goods might be facing the problem.'},
            { id: 42, title: 'Profit Revive', type: 'Profitability', difficulty: 'Moderate', company: 'Accenture Strategy', problem: 'Your client is an owner of a toy store situated in a fairly busy area. The business is doing good. Revenues have increased and the cost has also not shown any alarming fluctuation. However, the profitability of the business is going down. Find out the reason and suggest remedies.'},
            { id: 43, title: 'Reading Revenues', type: 'Profitability', difficulty: 'High', company: 'Nation With Namo', problem: 'You are the Marketing Manager of your favourite author. Your task is to double the sales of your favourite book by this author. How would you do this?'},
            { id: 44, title: 'Retail Landscape Analysis', type: 'Market Entry', difficulty: 'High', company: 'Kearney', problem: 'Our Client is a high-end retail chain based in India. Estimate the market size and the number of supermarket stores that we could get for the client.'},
            { id: 45, title: 'Ride on Hotel California', type: 'Market Entry', difficulty: 'Moderate', company: 'Alvarez and Marsal', problem: 'A hotel wants to install an amusement park in the premises. What is your take on the same ?'},
            { id: 46, title: 'Sky High Harvest', type: 'Profitability', difficulty: 'Easy', company: 'Boston Consulting Group', problem: 'Your client is a tractor manufacturer. They have been facing a decline in sales for the past one year. You need to find out the reason for the decline.'},
            { id: 47, title: 'Sole Mates', type: 'Market Entry', difficulty: 'Easy', company: 'LEK Capability Network', problem: 'Your client is a sneaker manufacturer in the footwear industry and they are trying to expand into other sectors. Decode the factors that must be considered by the company to expand into a new sector. What products do you think they can enter into?'},
            { id: 48, title: 'Statistically Speaking', type: 'Unconventional', difficulty: 'Easy', company: 'Bain Capability Network', problem: 'You are running an election for the President of the Statistics Department. How do you run a successful campaign?'},
            { id: 49, title: 'The Dotcom Crisis', type: 'Market Entry', difficulty: 'Moderate', company: 'Indus Insights', problem: 'Your client is an e-commerce company. It’s looking to enter the US market. For their entry, they’re looking to market themselves through two different methods of SEO- banner ads and URL ads. Which type of ads should the company proceed with?'},
            { id: 50, title: 'The Fast & The Furious', type: 'Unconventional', difficulty: 'Moderate', company: 'Bain & Co.', problem: 'Your client has found a new method to transport people from India to the USA in just 30 minutes. Decide how to price this service.'},
            { id: 51, title: 'The Social Dilemma', type: 'Unconventional', difficulty: 'Moderate', company: 'Boston Consulting Group', problem: 'Your driver gets 20,000 rs. a month. He heard from somewhere that he can make more money if he joins Uber. Elaborate on what you think would be the right decision for him.'},
            { id: 52, title: 'Time in a Bottle', type: 'Market Entry', difficulty: 'Moderate', company: 'LEK Capability Network', problem: 'There is a healthcare company in the United States that makes products for various diseases, and now the company is planning to enter the smartwatch sector. What are the factors that you would consider?'},
            { id: 53, title: 'TimeWarp Travel', type: 'Pricing', difficulty: 'Moderate', company: 'Kearney', problem: 'Your client is an Airplane service provider. A new service has been introduced that enables you to travel from New Delhi to New York in just one hour, and they are promoting their brand based on the time-saving aspect of this service. How would you price this service?'},
            { id: 54, title: 'TRUCKload of Gasoline', type: 'Profitability', difficulty: 'Easy', company: 'LEK Capability Network', problem: 'Your client is a trucking company deciding between adopting an electric fleet or a gasoline fleet. As a consultant, determine the optimal choice.'},
            { id: 55, title: 'Unwaivering Allegiance', type: 'Unconventional', difficulty: 'Easy', company: 'Bain & Co.', problem: 'An e-commerce brand is trying to launch a loyalty programme, you are required to delve into the expected costs of the programme.'},
            { id: 56, title: 'Where are the Kids?', type: 'Unconventional', difficulty: 'Easy', company: 'Nation with Namo', problem: 'Elections often face apathy from certain sections of society like women, the elderly etc. How would you increase youth participation in election?'}
        ];
        const casebooks = {
            1: 'cases/Accelerating Prosperity II Growth II Easy II Kepler Cannon.pdf',
            2: 'cases/An Apple a Day II Unconventional II Easy II Accenture Strategy.pdf',
            3: 'cases/Brewing Success II Market Entry II Moderate II Accenture Strategy.pdf',
            4: 'cases/Bucks over Brands II Market Entry II Moderate II LEK Capability Network.pdf',
            5: 'cases/Building the Bank II Profitability II High II McKinsey & Co..pdf',
            6: 'cases/Can Taylor Swift come to India II Profitability II High II McKinsey & Co..pdf',
            7: 'cases/Can the ants cross each other II Unconventional II Moderate II Bain Capability Network.pdf',
            8: 'cases/Candy Catastrophe II Profitability II Moderate II Accenture Strategy.pdf',
            9: 'cases/Cash Capsule II Profitability II Moderate II McKinsey & Co..pdf',
            10: 'cases/Chic Expansion II Market Entry II Moderate II BOD Consulting.pdf',
            11: 'cases/Childhood Shield II Unconventional II High II McKinsey & Co..pdf',
            12: 'cases/Coffee Madness II Market Entry II Easy II Accenture Strategy.pdf',
            13: 'cases/Cracking the Tile II Profitability II Moderate II Boston Consulting Group.pdf',
            14: 'cases/Data Insight II Unconventional II High II McKinsey & Co..pdf',
            15: "cases/Don't Sugarcoat it! II Profitability II Easy II Nation with Namo.pdf",
            16: 'cases/Droned Crops! II Market Entry II Moderate II McKinsey & Co..pdf',
            17: 'cases/Dynamic Democracy II Unconventional II Easy II Nation With Namo.pdf',
            18: 'cases/Efficient Transit II Unconventional II High II Kearney.pdf',
            19: 'cases/Expansion Endeavours II Growth II Moderate II Boston Consulting Group.pdf',
            20: 'cases/Fitness Finances II Market Entry II Moderate II LEK Capability Network.pdf',
            21: 'cases/Get your Pulse on It II Market Entry II Moderate II Bain Capability Network.pdf',
            22: 'cases/Good and Excellent II Profitability II Moderate II LEK Capability Network.pdf',
            23: 'cases/Growth Beyond Borders II Market Entry II High II LEK Capability Network.pdf',
            24: 'cases/Home Haven Expansion II Growth II Moderate II Redseer Consulting.pdf',
            25: 'cases/Hotel Shotel II Market Entry II High II Kearney.pdf',
            26: 'cases/Ink In or Ink Out II Market Entry II High II Accenture Strategy.pdf',
            27: 'cases/Learning the English Way II Unconventional II High II Alvarez and Marsal.pdf',
            28: 'cases/LifeEpic Launch II Market Entry II Moderate II LEK Capability Network.pdf',
            29: 'cases/Lights, Camera, Fashion! II Market Entry II High II LEK Capability Network.pdf',
            30: 'cases/Logistics Boost II Unconventional II High II Kearney.pdf',
            31: 'cases/Lubricant Lament II Growth II Moderate II Boston Consulting Group.pdf',
            32: 'cases/Lux Cabs but Lax Revenues II Profitability II Moderate II LEK Capability Network.pdf',
            33: 'cases/Mad Amount of Angles II Profitability II Easy II Boston Consulting Group.pdf',
            34: 'cases/Meat Me at our Spot II Unconventional II Easy II Boston Consulting Group.pdf',
            35: 'cases/Metals to Multiverse II Market Entry II High II Kepler Cannon.pdf',
            36: 'cases/Not a Coin Toss II Unconventional II Moderate II Nation with Namo.pdf',
            37: 'cases/Party at the Polls II Unconventional II Moderate II Nation With Namo.pdf',
            38: 'cases/Pigment Prospects II Market Entry II Moderate II McKinsey & Co..pdf',
            39: 'cases/Pipes to Progress II Growth II High II Kearney.pdf',
            40: 'cases/Potato Potahto II Profitability II Easy II Bain Capability Network.pdf',
            41: 'cases/Profit Puzzle II Profitability II High II LEK Capability Network.pdf',
            42: 'cases/Profit Revive II Profitability II Moderate II Accenture Strategy.pdf',
            43: 'cases/Reading Revenues II Profitability II High II Nation With Namo.pdf',
            44: 'cases/Retail Landscape Analysis II Market Entry II High II Kearney.pdf',
            45: 'cases/Ride on Hotel California II Market Entry II Moderate II Alvarez and Marsal.pdf',
            46: 'cases/Sky High Harvest II Profitability II Easy II Boston Consulting Group.pdf',
            47: 'cases/Sole Mates II Market Entry II Easy II LEK Capability Network.pdf',
            48: 'cases/Statistically Speaking II Unconventional II Easy II Bain Capability Network.pdf',
            49: 'cases/The Dotcom Crisis II Market Entry II Moderate II Indus Insights.pdf',
            50: 'cases/The Fast & The Furious II Unconventional II Moderate II Bain & Co..pdf',
            51: 'cases/The Social Dilemma II Unconventional II Moderate II Boston Consulting Group.pdf',
            52: 'cases/Time in a Bottle II Market Entry II Moderate II LEK Capability Network.pdf',
            53: 'cases/TimeWarp Travel II Pricing II Moderate II Kearney.pdf',
            54: 'cases/TRUCKload of Gasoline II Profitability II Easy II LEK Capability Network.pdf',
            55: 'cases/Unwaivering Allegiance II Unconventional II Easy II Bain & Co..pdf',
            56: 'cases/Where are the Kids II Unconventional II Easy II Nation with Namo.pdf',
            default: 'cases/Accelerating Prosperity II Growth II Easy II Kepler Cannon.pdf'
        };

        // --- State Management ---
        let currentCase = null;
        let pdfDoc = null, pageNum = 1, pageRendering = false, pageNumPending = null;
        let currentRenderTask = null;
        let selectedTypes = [];
        let selectedDifficulties = [];
        let selectedCompanies = [];

        // --- DOM Elements ---
        const welcomeView = document.getElementById('welcome-view');
        const caseLibraryView = document.getElementById('case-library-view');
        const detailedCaseView = document.getElementById('detailed-case-view');
        const inProgressView = document.getElementById('in-progress-view');
        const aboutView = document.getElementById('about-view');
        const dashboardView = document.getElementById('dashboard-view');
        
        const caseGrid = document.getElementById('case-grid');
        const homeButton = document.getElementById('home-button');
        const navDashboardBtn = document.getElementById('nav-dashboard-btn');
        const navAboutBtn = document.getElementById('nav-about-btn');
        
        // Filter elements
        const typeFiltersContainer = document.getElementById('type-filters');
        const difficultyFiltersContainer = document.getElementById('difficulty-filters');
        const openCompanyModalBtn = document.getElementById('open-company-modal-btn');
        const companyCountEl = document.getElementById('company-count');
        const searchCasesBtn = document.getElementById('search-cases-btn');
        const viewAllBtn = document.getElementById('view-all-btn');
        const backToFiltersBtn = document.getElementById('back-to-filters-btn');

        // Detailed View Elements
        const backToLibraryBtn = document.getElementById('back-to-library-btn');
        const doCaseBtn = document.getElementById('do-case-btn');

        // In-Progress View Elements
        const endCaseBtn = document.getElementById('end-case-btn');
        const pdfCanvas = document.getElementById('pdf-canvas'),
              pdfRenderContainer = document.getElementById('pdf-render-container'),
              pageNumEl = document.getElementById('page-num'),
              pageCountEl = document.getElementById('page-count'),
              prevPageBtn = document.getElementById('pdf-prev'),
              nextPageBtn = document.getElementById('pdf-next'),
              fullscreenBtn = document.getElementById('pdf-fullscreen');

        // Modals
        const companyModal = document.getElementById('company-modal');
        const warningModal = document.getElementById('warning-modal');
        const feedbackModal = document.getElementById('feedback-modal');
        const companyListContainer = document.getElementById('company-list');
        const allCompaniesCheckbox = document.getElementById('all-companies-checkbox');
        const clearCompaniesBtn = document.getElementById('clear-companies-btn');
        const applyCompaniesBtn = document.getElementById('apply-companies-btn');
        const cancelWarningBtn = document.getElementById('cancel-warning-btn');
        const proceedBtn = document.getElementById('proceed-btn');
        
        // Feedback Modal Elements
        const ratingParameters = document.getElementById('rating-parameters');
        const overallRatingDisplay = document.getElementById('overall-rating-display');
        const saveFeedbackBtn = document.getElementById('save-feedback-btn');

        // --- Main App Functions ---

        function showView(viewToShow) {
            [welcomeView, caseLibraryView, detailedCaseView, inProgressView, aboutView, dashboardView].forEach(view => {
                view.classList.add('hidden');
            });
            viewToShow.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function createCaseCard(caseData) {
            const card = document.createElement('div');
            card.className = 'case-card bg-white p-6 rounded-lg cursor-pointer flex flex-col';
            card.innerHTML = `
                <h3 class="font-bold text-xl mb-2 truncate">${caseData.title}</h3>
                <p class="text-slate-500 text-sm mb-4 h-10 overflow-hidden flex-grow">${caseData.problem}</p>
                <div class="flex items-center flex-wrap gap-2 text-sm text-slate-500 mt-4">
                    <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full font-medium">${caseData.type}</span>
                    <span class="bg-green-100 text-green-800 px-2 py-0.5 rounded-full font-medium">${caseData.company}</span>
                    <span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-medium">${caseData.difficulty}</span>
                </div>
            `;
            card.addEventListener('click', () => showDetailedCaseView(caseData.id));
            return card;
        }
        
        function renderLibraryView(casesToRender) {
            caseGrid.innerHTML = casesToRender.length === 0 ? `<p class="text-slate-500 col-span-full text-center text-lg">No cases match your criteria. Try broadening your search!</p>` : '';
            casesToRender.forEach(c => caseGrid.appendChild(createCaseCard(c)));
            showView(caseLibraryView);
        }
        
        function showDetailedCaseView(caseId) {
            const caseData = allCases.find(c => c.id === caseId);
            if (!caseData) return;
            currentCase = caseData;
            document.getElementById('case-detail-type').textContent = caseData.type;
            document.getElementById('case-detail-company').textContent = caseData.company;
            document.getElementById('case-detail-difficulty').textContent = caseData.difficulty;
            document.getElementById('case-detail-problem').textContent = caseData.problem;
            showView(detailedCaseView);
        }
        
        async function showInProgressView() {
            document.getElementById('casebook-title').textContent = `Interviewer's Guide: ${currentCase.title}`;
            const pdfPath = casebooks[currentCase.id] || casebooks.default;
            await initPdfViewer(pdfPath);
            showView(inProgressView);
        }

        // --- Filter Population and Handling ---

        function populateMultiSelectFilters(container, items, stateArray) {
            container.innerHTML = '';
            const allBtn = document.createElement('button');
            allBtn.className = 'filter-btn px-4 py-2 rounded-lg font-medium active';
            allBtn.textContent = 'All';
            allBtn.dataset.value = 'All';
            container.appendChild(allBtn);

            items.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn px-4 py-2 rounded-lg font-medium';
                btn.textContent = item;
                btn.dataset.value = item;
                container.appendChild(btn);
            });

            container.addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON') return;
                const value = e.target.dataset.value;
                const allButton = container.querySelector('[data-value="All"]');
                
                if (value === 'All') {
                    e.target.classList.add('active');
                    container.querySelectorAll('button:not([data-value="All"])').forEach(btn => btn.classList.remove('active'));
                    stateArray.length = 0;
                } else {
                    allButton.classList.remove('active');
                    e.target.classList.toggle('active');
                    const index = stateArray.indexOf(value);
                    if (index > -1) {
                        stateArray.splice(index, 1);
                    } else {
                        stateArray.push(value);
                    }
                    if (container.querySelectorAll('button.active:not([data-value="All"])').length === 0) {
                        allButton.classList.add('active');
                    }
                }
            });
        }
        
        function populateCompanyModal() {
            const companies = [...new Set(allCases.map(c => c.company))].sort();
            companyListContainer.innerHTML = '';
            companies.forEach(company => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 text-slate-700';
                label.innerHTML = `
                    <input type="checkbox" value="${company}" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 company-checkbox">
                    <span>${company}</span>
                `;
                companyListContainer.appendChild(label);
            });
        }
        
        function handleSearch() {
            const filteredCases = allCases.filter(c => {
                const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(c.type);
                const difficultyMatch = selectedDifficulties.length === 0 || selectedDifficulties.includes(c.difficulty);
                const companyMatch = selectedCompanies.length === 0 || selectedCompanies.includes(c.company);
                return typeMatch && difficultyMatch && companyMatch;
            });
            renderLibraryView(filteredCases);
        }

        // --- PDF Viewer Functions ---
        async function initPdfViewer(url) {
            pageNum = 1;
            try {
                const loadingTask = pdfjsLib.getDocument(url);
                pdfDoc = await loadingTask.promise;
                pageCountEl.textContent = pdfDoc.numPages;
                renderPage(pageNum);
            } catch (error) {
                console.error('Error loading PDF:', error);
                pdfRenderContainer.innerHTML = `<p class="text-red-500 text-center">Error: Could not load PDF file. Please ensure the file '${url}' is in the correct folder.</p>`;
            }
        }

        function renderPage(num, isResize = false) {
            if (pageRendering) {
                if(currentRenderTask) currentRenderTask.cancel();
                pageNumPending = num;
                return;
            }
            pageRendering = true;

            if (!isResize) pdfCanvas.style.opacity = '0';

            pdfDoc.getPage(num).then(page => {
                const devicePixelRatio = window.devicePixelRatio || 1;
                const viewport1 = page.getViewport({ scale: 1 });
                const scale = pdfRenderContainer.clientWidth / viewport1.width;
                const viewport = page.getViewport({ scale: scale });
                const context = pdfCanvas.getContext('2d');
                
                pdfCanvas.style.width = `${viewport.width}px`;
                pdfCanvas.style.height = `${viewport.height}px`;
                pdfCanvas.width = Math.floor(viewport.width * devicePixelRatio);
                pdfCanvas.height = Math.floor(viewport.height * devicePixelRatio);
                context.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };

                currentRenderTask = page.render(renderContext);
                currentRenderTask.promise.then(() => {
                    pageRendering = false;
                    currentRenderTask = null;
                    if (!isResize) pdfCanvas.style.opacity = '1';
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
            pageNumEl.textContent = num;
            updateNavButtons();
        }

        function onPrevPage() { if (pageNum <= 1) return; pageNum--; renderPage(pageNum); }
        function onNextPage() { if (pageNum >= pdfDoc.numPages) return; pageNum++; renderPage(pageNum); }

        function updateNavButtons() {
            prevPageBtn.disabled = (pageNum <= 1);
            nextPageBtn.disabled = (pageNum >= pdfDoc.numPages);
        }

        function toggleFullscreen() {
             if (!document.fullscreenElement) {
                pdfRenderContainer.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // --- Modal Logic ---
        function openCompanyModal() { companyModal.classList.remove('hidden'); companyModal.classList.add('flex'); }
        function closeCompanyModal() { companyModal.classList.remove('flex'); companyModal.classList.add('hidden'); }
        function openWarningModal() { warningModal.classList.remove('hidden'); warningModal.classList.add('flex');}
        function closeWarningModal() { warningModal.classList.remove('flex'); warningModal.classList.add('hidden');}
        function openFeedbackModal() { 
            resetFeedbackModal();
            feedbackModal.classList.remove('hidden'); 
            feedbackModal.classList.add('flex');
        }
        function closeFeedbackModal() { 
            feedbackModal.classList.remove('flex'); 
            feedbackModal.classList.add('hidden'); 
            showView(caseLibraryView); 
        }
        
        function applyCompanySelection() {
            selectedCompanies = Array.from(companyListContainer.querySelectorAll('.company-checkbox:checked')).map(cb => cb.value);
            if (selectedCompanies.length === 0) {
                companyCountEl.textContent = 'All companies selected';
            } else if (selectedCompanies.length === 1) {
                companyCountEl.textContent = '1 company selected';
            } else {
                companyCountEl.textContent = `${selectedCompanies.length} companies selected`;
            }
            closeCompanyModal();
        }

        // --- Feedback Modal Functions ---
        function calculateOverallRating() {
            let totalScore = 0;
            const ratingGroups = ratingParameters.querySelectorAll('.star-rating');

            ratingGroups.forEach(group => {
                const weight = parseFloat(group.dataset.weight);
                const checkedRadio = group.querySelector('input[type="radio"]:checked');
                const value = checkedRadio ? parseInt(checkedRadio.value) : 0;
                totalScore += value * weight;
            });
            
            updateOverallRatingDisplay(totalScore);
        }

        function updateOverallRatingDisplay(score) {
            overallRatingDisplay.innerHTML = ''; // Clear previous stars
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.classList.add('star');
                if (i <= Math.round(score)) {
                    star.classList.add('filled');
                }
                star.innerHTML = '&#9733;';
                overallRatingDisplay.appendChild(star);
            }
        }
        
        function resetFeedbackModal() {
            // Uncheck all radio buttons
            const allRadios = feedbackModal.querySelectorAll('input[type="radio"]');
            allRadios.forEach(radio => radio.checked = false);
            // Recalculate and update the display to show 0 stars
            calculateOverallRating();
        }

        // --- Initial Load & Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => { 
            const uniqueTypes = [...new Set(allCases.map(c => c.type))].sort();
            const uniqueDifficulties = [...new Set(allCases.map(c => c.difficulty))].sort();
            
            populateMultiSelectFilters(typeFiltersContainer, uniqueTypes, selectedTypes);
            populateMultiSelectFilters(difficultyFiltersContainer, uniqueDifficulties, selectedDifficulties);
            populateCompanyModal();
            
            showView(welcomeView);
            updateOverallRatingDisplay(0); // Initialize overall rating display
            
            // Initialize Dashboard
            initializeDashboard();
        });

        // Navigation
        homeButton.addEventListener('click', () => showView(welcomeView));
        navDashboardBtn.addEventListener('click', () => showView(dashboardView));
        navAboutBtn.addEventListener('click', () => showView(aboutView));
        backToFiltersBtn.addEventListener('click', () => showView(welcomeView));
        backToLibraryBtn.addEventListener('click', () => showView(caseLibraryView));
        
        // Actions
        searchCasesBtn.addEventListener('click', handleSearch);
        viewAllBtn.addEventListener('click', () => renderLibraryView(allCases));
        doCaseBtn.addEventListener('click', openWarningModal);
        endCaseBtn.addEventListener('click', openFeedbackModal);
        
        // PDF Controls
        prevPageBtn.addEventListener('click', onPrevPage);
        nextPageBtn.addEventListener('click', onNextPage);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        document.addEventListener('fullscreenchange', () => {
            if (pdfDoc) {
                setTimeout(() => renderPage(pageNum, true), 100);
            }
        });

        // Company Modal
        openCompanyModalBtn.addEventListener('click', openCompanyModal);
        applyCompaniesBtn.addEventListener('click', applyCompanySelection);
        companyModal.addEventListener('click', (e) => { if(e.target === companyModal) closeCompanyModal(); });
        allCompaniesCheckbox.addEventListener('change', (e) => {
            companyListContainer.querySelectorAll('.company-checkbox').forEach(cb => { cb.checked = e.target.checked; });
        });
        clearCompaniesBtn.addEventListener('click', () => {
             companyListContainer.querySelectorAll('.company-checkbox').forEach(cb => { cb.checked = false; });
            allCompaniesCheckbox.checked = false;
        });
        
        // Warning Modal
        cancelWarningBtn.addEventListener('click', closeWarningModal);
        proceedBtn.addEventListener('click', () => { closeWarningModal(); showInProgressView(); });

        // Feedback Modal
        saveFeedbackBtn.addEventListener('click', () => {
             console.log('Feedback saved!'); // Placeholder for actual submission logic
             closeFeedbackModal();
        });
        ratingParameters.addEventListener('change', calculateOverallRating);

        // ====================================================================
        // --- DASHBOARD SCRIPT ---
        // ====================================================================

        function initializeDashboard() {
            // --- Dashboard Data ---
            const dashboardCaseData = [
                { name: 'Coffee Shop Profitability', company: 'Bain', date: '2025-08-18', type: 'Profitability', difficulty: 'Easy', structuring: 28, quantitative: 15, insight: 22, communication: 18 },
                { name: 'EV Market Entry', company: 'BCG', date: '2025-08-18', type: 'Market Entry', difficulty: 'Medium', structuring: 22, quantitative: 14, insight: 15, communication: 15 },
                { name: 'Pharma M&A', company: 'McKinsey', date: '2025-08-19', type: 'M&A', difficulty: 'Hard', structuring: 18, quantitative: 13, insight: 12, communication: 14 },
                { name: 'Retail Growth Strategy', company: 'LEK', date: '2025-08-20', type: 'Growth', difficulty: 'Medium', structuring: 25, quantitative: 15, insight: 18, communication: 17 },
                { name: 'Airline Cost Reduction', company: 'EYP', date: '2025-08-20', type: 'Profitability', difficulty: 'Medium', structuring: 26, quantitative: 14, insight: 25, communication: 19 },
                { name: 'CPG New Product', company: 'Strategy&', date: '2025-08-21', type: 'Market Entry', difficulty: 'Hard', structuring: 20, quantitative: 13, insight: 14, communication: 13 },
                { name: 'Manufacturing Ops', company: 'Kearney', date: '2025-09-02', type: 'Profitability', difficulty: 'Easy', structuring: 30, quantitative: 15, insight: 28, communication: 20 },
            ];
            const maxScores = { structuring: 30, quantitative: 15, insight: 35, communication: 20 };

            // --- Dashboard State ---
            let analyticalFilters = {};
            let dateRange = { start: null, end: null };

            // --- Dashboard Helper Functions ---
            const calculateWeightedScore = (caseItem) => {
                const weights = { structuring: 30, quantitative: 15, insight: 35, communication: 20 };
                return Math.round(Object.keys(weights).reduce((acc, key) => acc + (caseItem[key] / maxScores[key]) * weights[key], 0));
            };
            const getScoreColor = (score) => {
                if (score >= 85) return 'from-green-500 to-green-400';
                if (score >= 70) return 'from-amber-500 to-amber-400';
                return 'from-red-600 to-red-500';
            };
            const getScoreTextColor = (score) => {
                if (score >= 85) return 'text-green-600';
                if (score >= 70) return 'text-amber-600';
                return 'text-red-600';
            };

            // --- Main Render Function ---
            function renderDashboard() {
                const globallyFilteredCases = dashboardCaseData.filter(c => {
                    const caseDate = new Date(c.date);
                    const isAfterStart = !dateRange.start || caseDate >= dateRange.start;
                    const isBeforeEnd = !dateRange.end || caseDate <= dateRange.end;
                    const typeMatch = !analyticalFilters.type || c.type === analyticalFilters.type;
                    const difficultyMatch = !analyticalFilters.difficulty || c.difficulty === analyticalFilters.difficulty;
                    return isAfterStart && isBeforeEnd && typeMatch && difficultyMatch;
                });

                renderActiveFilters(analyticalFilters);
                renderScoreCard(globallyFilteredCases);
                renderDetailedMetrics(globallyFilteredCases);
                renderBarCharts(globallyFilteredCases);
                renderKeyTakeaways(globallyFilteredCases);
                renderCaseSummary(globallyFilteredCases);
                renderCalendar(dashboardCaseData); // Calendar always shows all data
            }

            // --- Component Rendering Functions ---

            function renderDateRangePicker() {
                const container = document.getElementById('dashboard-date-picker');
                container.innerHTML = `
                    <select id="date-range-type" class="text-sm border-gray-300 rounded-md shadow-sm">
                        <option value="all">All Time</option>
                        <option value="this_month">This Month</option>
                        <option value="last_month">Last Month</option>
                        <option value="custom">Custom Range</option>
                    </select>
                    <div id="custom-range-inputs" class="hidden items-center gap-2">
                        <input type="date" id="date-start" class="text-sm border-gray-300 rounded-md shadow-sm"/>
                        <input type="date" id="date-end" class="text-sm border-gray-300 rounded-md shadow-sm"/>
                    </div>
                    <button id="apply-date-range" class="text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700">Apply</button>
                `;

                const rangeTypeSelect = document.getElementById('date-range-type');
                const customInputs = document.getElementById('custom-range-inputs');
                
                rangeTypeSelect.addEventListener('change', (e) => {
                    customInputs.classList.toggle('hidden', e.target.value !== 'custom');
                });

                document.getElementById('apply-date-range').addEventListener('click', () => {
                    const rangeType = rangeTypeSelect.value;
                    let start = null, end = null;
                    const today = new Date();
                    if (rangeType === 'this_month') {
                        start = new Date(today.getFullYear(), today.getMonth(), 1);
                        end = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    } else if (rangeType === 'last_month') {
                        start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                        end = new Date(today.getFullYear(), today.getMonth(), 0);
                    } else if (rangeType === 'custom') {
                        const startVal = document.getElementById('date-start').value;
                        const endVal = document.getElementById('date-end').value;
                        if (startVal && endVal) {
                            start = new Date(startVal);
                            end = new Date(endVal);
                        }
                    }
                    dateRange = { start, end };
                    renderDashboard();
                });
            }

            function renderActiveFilters(filters) {
                const container = document.getElementById('dashboard-active-filters');
                const active = Object.entries(filters).filter(([, value]) => value);
                if (active.length === 0) {
                    container.innerHTML = '';
                    return;
                }
                
                const filterItems = active.map(([key, value]) => `
                    <div class="flex items-center bg-blue-200 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full">
                        <span class="capitalize">${key}: ${value}</span>
                        <button data-key="${key}" class="ml-2 text-blue-600 hover:text-blue-900 clear-filter-btn">&times;</button>
                    </div>
                `).join('');

                container.innerHTML = `
                    <div class="flex items-center gap-2 mb-4 p-2 bg-blue-50 border border-blue-200 rounded-lg">
                        <span class="font-semibold text-sm text-gray-700">Filters Applied:</span>
                        ${filterItems}
                        <button id="clear-all-filters-btn" class="ml-auto text-sm font-semibold text-blue-600 hover:text-blue-800">Clear All</button>
                    </div>
                `;

                document.querySelectorAll('.clear-filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const key = e.target.dataset.key;
                        delete analyticalFilters[key];
                        renderDashboard();
                    });
                });
                document.getElementById('clear-all-filters-btn').addEventListener('click', () => {
                    analyticalFilters = {};
                    renderDashboard();
                });
            }

            function renderScoreCard(cases) {
                const container = document.getElementById('dashboard-score-card');
                const score = cases.length > 0 ? Math.round(cases.reduce((acc, curr) => acc + calculateWeightedScore(curr), 0) / cases.length) : 0;
                container.innerHTML = `
                    <div class="${getScoreTextColor(score)}">
                        <span class="text-6xl">${score}</span>
                        <span class="text-2xl text-gray-400"> / 100</span>
                    </div>
                `;
            }

            function renderDetailedMetrics(cases) {
                const container = document.getElementById('dashboard-metric-breakdown');
                let content = '';
                if (cases.length > 0) {
                    const avgMetrics = {
                        structuring: cases.reduce((acc, c) => acc + c.structuring, 0) / cases.length,
                        quantitative: cases.reduce((acc, c) => acc + c.quantitative, 0) / cases.length,
                        insight: cases.reduce((acc, c) => acc + c.insight, 0) / cases.length,
                        communication: cases.reduce((acc, c) => acc + c.communication, 0) / cases.length,
                    };
                    const metricData = Object.keys(maxScores).map(key => ({ 
                        name: key.charAt(0).toUpperCase() + key.slice(1), 
                        score: avgMetrics[key], 
                        maxScore: maxScores[key] 
                    }));

                    const itemsHTML = metricData.map(item => {
                        const percentage = Math.round((item.score / item.maxScore) * 100);
                        return `
                            <div class="flex items-center">
                                <div class="w-28 text-sm text-gray-600">${item.name}</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-6">
                                    <div class="bg-gradient-to-r ${getScoreColor(percentage)} h-6 rounded-full text-white text-xs flex items-center justify-center font-semibold" style="width: ${percentage}%">${percentage}%</div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    content = `<div class="space-y-3">${itemsHTML}</div>`;
                } else {
                    content = `<p class="text-gray-500 text-center py-4">No matching cases found.</p>`;
                }
                
                container.innerHTML = `
                    <div class="bg-white p-4 rounded-lg shadow dashboard-animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Metric Breakdown</h3>
                        ${content}
                    </div>
                `;
            }

            function renderBarCharts(cases) {
                const performanceByGroup = (dataSource, groupingKey) => {
                    const groups = {};
                    dataSource.forEach(c => {
                        const key = c[groupingKey];
                        if (!groups[key]) groups[key] = { totalScore: 0, count: 0 };
                        groups[key].totalScore += calculateWeightedScore(c);
                        groups[key].count++;
                    });
                    return Object.entries(groups).map(([key, value]) => ({ name: key, score: Math.round(value.totalScore / value.count) })).sort((a, b) => b.score - a.score);
                };

                const performanceByTypeData = performanceByGroup(cases, 'type');
                const performanceByDifficultyData = performanceByGroup(cases, 'difficulty');

                renderSingleBarChart('dashboard-type-chart', 'Performance by Case Type', performanceByTypeData, 'type');
                renderSingleBarChart('dashboard-difficulty-chart', 'Performance by Difficulty', performanceByDifficultyData, 'difficulty');
            }

            function renderSingleBarChart(containerId, title, data, filterType) {
                const container = document.getElementById(containerId);
                let content = '';
                if (data.length > 0) {
                    const barsHTML = data.map(item => {
                        const isActive = analyticalFilters[filterType] === item.name;
                        return `
                            <div class="flex items-center group bar-chart-item" data-type="${filterType}" data-value="${item.name}">
                                <div class="w-24 text-sm text-gray-600">${item.name}</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-6 cursor-pointer transition-all duration-200 ${isActive ? 'ring-2 ring-blue-500' : ''}">
                                    <div class="bg-gradient-to-r ${getScoreColor(item.score)} h-6 rounded-full text-white text-xs flex items-center justify-center font-bold" style="width: ${item.score}%">${item.score}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    content = `<div class="space-y-2">${barsHTML}</div>`;
                } else {
                    content = `<p class="text-sm text-gray-500 text-center py-2">No data for this filter.</p>`;
                }

                container.innerHTML = `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex justify-between items-baseline mb-2">
                            <h3 class="text-lg font-semibold text-gray-700">${title}</h3>
                            <span class="text-xs text-gray-400 italic">Click bars to filter</span>
                        </div>
                        ${content}
                    </div>
                `;

                document.querySelectorAll(`#${containerId} .bar-chart-item`).forEach(item => {
                    item.addEventListener('click', (e) => {
                        const current = e.currentTarget;
                        const type = current.dataset.type;
                        const value = current.dataset.value;
                        analyticalFilters[type] = analyticalFilters[type] === value ? undefined : value;
                        renderDashboard();
                    });
                });
            }

            function renderKeyTakeaways(cases) {
                const container = document.getElementById('dashboard-key-takeaways');
                if (cases.length < 2) {
                    container.innerHTML = `<div class="bg-white p-6 rounded-lg shadow lg:col-span-3 text-center text-gray-500">Not enough data to generate insights for the current filters.</div>`;
                    return;
                }

                const getMetricPerformance = (caseSet) => {
                    const performance = {};
                    Object.keys(maxScores).forEach(key => {
                        const avgScore = caseSet.reduce((acc, c) => acc + c[key], 0) / caseSet.length;
                        performance[key] = Math.round((avgScore / maxScores[key]) * 100);
                    });
                    return performance;
                };

                const overallPerf = getMetricPerformance(cases);
                const strength = Object.entries(overallPerf).reduce((max, item) => item[1] > max[1] ? item : max);
                const weakness = Object.entries(overallPerf).reduce((min, item) => item[1] < min[1] ? item : min);

                const types = [...new Set(cases.map(c => c.type))];
                const typeScores = types.map(type => {
                    const typeCases = cases.filter(c => c.type === type);
                    return { name: type, score: Math.round(typeCases.reduce((acc, c) => acc + calculateWeightedScore(c), 0) / typeCases.length) };
                });
                const bestType = typeScores.reduce((max, item) => item.score > max.score ? item : max, {score: -1});
                const worstType = typeScores.reduce((min, item) => item.score < min.score ? item : min, {score: 101});
                
                container.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow lg:col-span-3">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Key Takeaways</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-sm">
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center">⭐ Your Strength</h3>
                                <p>Your strongest area is <span class="font-bold text-green-600">${strength[0]}</span> with an average performance of <span class="font-bold">${strength[1]}%</span>.</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center">🎯 Focus Area</h3>
                                <p>The biggest opportunity for improvement is in <span class="font-bold text-red-600">${weakness[0]}</span>, currently at <span class="font-bold">${weakness[1]}%</span>.</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center">🚀 Best Case Type</h3>
                                <p>You excel at <span class="font-bold text-blue-600">${bestType.name}</span> cases, averaging a score of <span class="font-bold">${bestType.score}</span>.</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center">🔍 Review Needed</h3>
                                <p>Consider practicing more <span class="font-bold text-orange-600">${worstType.name}</span> cases, where your average score is <span class="font-bold">${worstType.score}</span>.</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderCaseSummary(cases) {
                const container = document.getElementById('dashboard-case-summary');
                let tableBody = '';
                if (cases.length > 0) {
                    tableBody = cases.map(c => `
                        <tr class="border-b last:border-none hover:bg-gray-50">
                            <td class="py-3 px-3 text-sm text-gray-600">${c.date}</td>
                            <td class="py-3 px-3">${c.company} - ${c.name}</td>
                            <td class="py-3 px-3"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${c.type}</span></td>
                            <td class="py-3 px-3"><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${c.difficulty}</span></td>
                            <td class="py-3 px-3 text-right font-semibold">${calculateWeightedScore(c)}</td>
                        </tr>
                    `).join('');
                } else {
                    tableBody = `<tr><td colspan="5" class="text-center py-8 text-gray-500">No cases match the current filters.</td></tr>`;
                }

                container.innerHTML = `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Case Summary</h2>
                        <div class="overflow-y-auto max-h-80">
                            <table class="w-full text-left">
                                <thead><tr class="border-b text-sm text-gray-500"><th class="py-2 px-3">Date</th><th class="py-2 px-3">Case Name</th><th class="py-2 px-3">Type</th><th class="py-2 px-3">Difficulty</th><th class="py-2 px-3 text-right">Score</th></tr></thead>
                                <tbody>${tableBody}</tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            function renderCalendar(data) {
                const container = document.getElementById('dashboard-calendar-tracker');
                let currentDate = new Date(2025, 7, 1); // August 2025

                const calendarData = {};
                data.forEach(c => {
                    if (!calendarData[c.date]) calendarData[c.date] = { count: 0, totalScore: 0, cases: [] };
                    calendarData[c.date].count++;
                    calendarData[c.date].totalScore += calculateWeightedScore(c);
                    calendarData[c.date].cases.push(c);
                });
                Object.keys(calendarData).forEach(date => {
                    calendarData[date].avgScore = Math.round(calendarData[date].totalScore / calendarData[date].count);
                });

                function drawCalendar() {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const startDay = new Date(year, month, 1).getDay();
                    const calendarDays = Array(startDay).fill(null).concat(Array.from({ length: daysInMonth }, (_, i) => i + 1));
                    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

                    const daysHTML = calendarDays.map((day, index) => {
                        const dateStr = day ? `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}` : '';
                        const dayData = dateStr ? calendarData[dateStr] : null;
                        let dayContent = '';
                        if (dayData) {
                            dayContent = `
                                <div class="text-xs mt-1 space-y-1">
                                    <div class="bg-blue-100 text-blue-800 rounded-full px-1">Cases: ${dayData.count}</div>
                                    <div class="${getScoreColor(dayData.avgScore).replace('from-', 'bg-').split(' ')[0]} text-white rounded-full px-1">Avg: ${dayData.avgScore}</div>
                                </div>
                            `;
                        }
                        return `
                            <div class="h-24 border rounded-md p-1 ${day ? (dayData ? 'cursor-pointer hover:bg-slate-100' : '') : 'bg-slate-50'}" data-date="${dateStr}">
                                ${day ? `<div class="font-semibold text-gray-700">${day}</div>` : ''}
                                ${dayContent}
                            </div>
                        `;
                    }).join('');

                    container.innerHTML = `
                        <div class="bg-white p-4 rounded-lg shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold text-gray-700">Progress Calendar</h2>
                                <div class="flex items-center gap-2">
                                    <button id="cal-prev" class="px-2 py-1 rounded-md hover:bg-gray-200">&lt;</button>
                                    <span class="font-bold w-32 text-center">${currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}</span>
                                    <button id="cal-next" class="px-2 py-1 rounded-md hover:bg-gray-200">&gt;</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-7 gap-1 text-center text-sm">
                                ${dayNames.map(day => `<div class="font-bold text-gray-500">${day}</div>`).join('')}
                                ${daysHTML}
                            </div>
                        </div>
                    `;

                    document.getElementById('cal-prev').addEventListener('click', () => {
                        currentDate.setMonth(currentDate.getMonth() - 1);
                        drawCalendar();
                    });
                    document.getElementById('cal-next').addEventListener('click', () => {
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        drawCalendar();
                    });
                    
                    container.querySelectorAll('[data-date]').forEach(cell => {
                        if (calendarData[cell.dataset.date]) {
                            cell.addEventListener('click', () => showCalendarModal(calendarData[cell.dataset.date]));
                        }
                    });
                }
                drawCalendar();
            }
            
            function showCalendarModal(dayData) {
                const modal = document.getElementById('calendar-modal');
                const content = document.getElementById('calendar-modal-content');

                const casesHTML = dayData.cases.map(c => `
                    <div class="border rounded-lg p-3">
                        <p class="font-semibold">${c.company} - ${c.name}</p>
                        <div class="flex gap-2 mt-1 text-xs">
                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full">${c.type}</span>
                            <span class="bg-green-100 text-green-800 px-2 py-0.5 rounded-full">${c.difficulty}</span>
                        </div>
                    </div>
                `).join('');

                content.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Cases for ${dayData.cases[0].date}</h3>
                        <button id="close-cal-modal" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                    </div>
                    <div class="space-y-4">${casesHTML}</div>
                `;
                
                modal.classList.remove('hidden');

                const closeModal = () => modal.classList.add('hidden');
                document.getElementById('close-cal-modal').addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
            }

            // --- Initial Dashboard Render ---
            renderDateRangePicker();
            renderDashboard();
        }
    </script>
</body>
</html>
